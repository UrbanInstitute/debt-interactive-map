var pathFiles="data/20240715-update/";function isDelinquency(t){var e=[];if(t==="delinquency_by_credit"){e=["_near","_pr"]}else{e=["_white","_com_col"]}return e}var Startquery={};if(window.location.search){Startquery=decodeQuery(window.location.search);if(Startquery["print"]==="true"){d3.select("body").classed("print",true)}}var IS_MOBILE;var IS_PHONE;var IS_PHONESM;var limitedVars=["poc","poprural"];var SELECTED_VARIABLE;var WHITE;var NONWHITE;var COLORRANGE=["#cfe8f3","#73bfe2","#1696d2","#0a4c6a","#000000"];var zoomState;var zoomNational;var zoomCounty;var zoomNational_St;var type;var typeVar;var tdMap;var printNameFinal;var active=d3.select(null);var dropdown;var margin=IS_PHONE?{top:10,right:30,bottom:10,left:30}:{top:10,right:0,bottom:10,left:45};function setWidth(t,e,a){var r=a?{top:10,right:30,bottom:10,left:30}:{top:10,right:0,bottom:10,left:45};if($("body").width()>1200){tdMap=870-r.right-r.left}else if($("body").width()<=1200&&!e){tdMap=t-r.right-r.left}else if(e&&!a){tdMap=t}else if(a){tdMap=t-r.right-r.left}}function setScreenState(t,e,a){IS_MOBILE=t;IS_PHONE=e;IS_PHONESM=a}setScreenState(d3.select("#isMobile").style("display")=="block",d3.select("#isPhone").style("display")=="block",d3.select("#isPhoneSm").style("display")=="block");d3.select("#notes-section > p.note4").style("display","none");d3.select("#notes > p.note4").style("display","none");function setVariable(t,e){if(e==true){SELECTED_VARIABLE_ph=t;WHITE_ph=t+isDelinquency(t)[0];NONWHITE_ph=t+isDelinquency(t)[1]}else{SELECTED_VARIABLE=t;WHITE=t+isDelinquency(t)[0];NONWHITE=t+isDelinquency(t)[1]}}function setZoom(t,e,a,r){zoomNational=t;zoomState=e;zoomCounty=a;zoomNational_St=r}var initialWidth=IS_PHONE?$("body").width():$("body").width()-$(".td-table").width()-15;setWidth(initialWidth,IS_MOBILE,IS_PHONE);function decodeQuery(t){var e=["county","variable","print","state","type"];var a=t.split("?");var r={},s=t.indexOf("?"),l=t.substr(s+1).split("&"),n=l.length-1;if(s!==-1||query.indexOf("=")!==-1){for(;n>=0;n--){var i=l[n].split("=");if(e.indexOf(i[0])!=-1){r[unescape(i[0])]=i.hasOwnProperty(1)?unescape(i[1]):null}}}return r}function updateQueryString(t,e,a,r,s){var l="";if(t){l+="?type="+t}else{l+=""}if(e){l+="&variable="+e}else{l+=""}if(a){l+="&state="+a}else{l+=""}if(r){if(r.toString().length===4){r="0"+r.toString()}selectedCounty=r;l+="&county="+r}else{selectedCounty="";l+=""}if(s){l+="&print=true"}else{l+=""}if(history.pushState){var n=window.location.protocol+"//"+window.location.host+window.location.pathname+l;window.history.pushState({path:n},"",n)}}function hidelimited(t){for(var e=0;e<limitedVars.length;e++){if(t==limitedVars[e]){d3.select("#County").selectAll(".White, .Nonwhite").style("opacity",0);d3.select("#State").selectAll(".White, .Nonwhite").style("opacity",0);d3.select("#National").selectAll(".White, .Nonwhite").style("opacity",0)}else{d3.select("#County").selectAll(".White, .Nonwhite").style("opacity",1);d3.select("#State").selectAll(".White, .Nonwhite").style("opacity",1);d3.select("#National").selectAll(".White, .Nonwhite").style("opacity",1)}}}function formatNumber(t,e){var a=d3.format(",.0%"),r=d3.format("$,.0f");if(e=="max"){return t<=1?a(Math.ceil(t*100)/100):r(Math.ceil((t+1)/10)*10)}else if(e=="min"){return t<=1?a(Math.floor(t*100)/100):r(Math.floor((t+1)/10)*10)}else{return t<=1?a(t):r(t)}}function barY(t,e,a,r,s,l,n){var i=d3.select(e.parentNode).attr("class");if(i.search("c0")>-1){return isNaN(t[a])!=true?l(t[a]):n}else if(i.search("c2")>-1){return isNaN(t[r])!=true?l(t[r]):n}else{return isNaN(t[s])!=true?l(t[s]):n}}function barH(t,e,a,r,s,l,n){var i=d3.select(e.parentNode).attr("class");if(i.search("c0")>-1){return isNaN(t[a])!=true?n-l(t[a]):0}else if(i.search("c2")>-1){return isNaN(+t[r])!=true?n-l(t[r]):0}else{return isNaN(t[s])!=true?n-l(t[s]):0}}function labelY(t,e,a,r,s,l,n){var i=d3.select(e.parentNode).attr("class");if(i.search("c0")>-1){return isNaN(t[a])!=true?l(t[a])-16:n-8}else if(i.search("c2")>-1){return isNaN(t[r])!=true?l(t[r])-16:n-8}else{return isNaN(t[s])!=true?l(t[s])-16:n-8}}function labelsuperscript(t,e,a,r,s){var l;var n=d3.select(e.parentNode.parentNode).attr("class");if(n.search("c0")>-1){l=a}else if(n.search("c2")>-1){l=r}else{l=s}if(isNaN(t[l])!=true){return""}else if(needsConnecticutACSnote(a).superscript){return"d"}else{return"b"}}function labelHTML(t,e,a,r,s){var l="n/a";var n=d3.select(e.parentNode).attr("class");if(n.search("c0")>-1){return isNaN(t[a])!=true?formatNumber(t[a]):l}else if(n.search("c2")>-1){return isNaN(t[r])!=true?formatNumber(t[r]):l}else{return isNaN(t[s])!=true?formatNumber(t[s]):l}}function barW(t,e,a,r,s,l){var n=d3.select(e.parentNode).attr("class");if(n.search("c0")>-1){return isNaN(t[a])!=true?l(t[a]):0}else if(n.search("c2")>-1){return isNaN(t[r])!=true?l(t[r]):0}else{return isNaN(t[s])!=true?l(t[s]):0}}function barX(t,e,a,r,s,l){var n=$(e).closest(".rect-g").attr("class");if(n.search("c0")>-1){return isNaN(t[a])!=true?l(t[a])+5:0}else if(n.search("c2")>-1){return isNaN(t[r])!=true?l(t[r])+5:0}else{return isNaN(t[s])!=true?l(t[s])+5:0}}function labelHTML_ph(t,e,a,r,s,l){var n=t[a]=="n<50"?"n/a<tspan font-style='italic'  baseline-shift='super'>b</tspan>":"n/a<tspan font-style='italic'  baseline-shift='super'>c</tspan>";var i=t[s]=="n<50"?"n/a<tspan font-style='italic'  baseline-shift='super'>b</tspan>":"n/a<tspan font-style='italic'  baseline-shift='super'>c</tspan>";var o=t[r]=="n<50"?"n/a<tspan font-style='italic'  baseline-shift='super'>b</tspan>":"n/a<tspan font-style='italic'  baseline-shift='super'>c</tspan>";var c=$(e).closest(".rect-g").attr("class");if(t[r]=="n<50"||t[s]=="n<50"||t[a]=="n<50"){d3.select("#notes-section > p.note1").style("opacity",1)}if(t[a]=="N/A"||t[r]=="N/A"||t[s]=="N/A"){d3.select("#notes-section > p.note2").style("opacity",1)}let d=needsConnecticutACSnote(a);d3.select("#notes-section > p.note4").style("display",d.note?"block":"none");d3.select("#notes > p.note4").style("display",d.note?"block":"none");if(c.search("c0")>-1){return isNaN(t[a])!=true?formatNumber(t[a]):n}else if(c.search("c2")>-1){return isNaN(t[r])!=true?formatNumber(t[r]):o}else{return isNaN(t[s])!=true?formatNumber(t[s]):i}}function hideBars(t){var e=0;for(var a=0;a<limitedVars.length;a++){if(t==limitedVars[a]){d3.selectAll(".bar-group-ph").selectAll(".category-ph.White").attr("display","none");d3.selectAll(".bar-group-ph").selectAll(".category-ph.Nonwhite").attr("display","none");d3.selectAll(".bar_ph").select("svg").attr("height",80);d3.selectAll(".label").select(".svg2").attr("height",38);e+=1}}if(e===0){var r=IS_PHONESM==true?200:173;d3.selectAll(".bar-group-ph").selectAll(".category-ph.White").attr("display","block");d3.selectAll(".bar-group-ph").selectAll(".category-ph.Nonwhite").attr("display","block");d3.selectAll(".bar_ph").select("svg").attr("height",r);d3.selectAll(".label").select(".svg2").attr("height",130)}}function needsConnecticutACSnote(t){let e=selectedState;if(!e)return{note:false,superscript:false};if(selectedState.id!="09")return{note:false,superscript:false};let a=d3.select("g.counties").selectAll("path.hover")._groups[0].length!==0||selectedCounty!="";if(!a)return{note:false,superscript:false};return["household_income_avg","poc","educ_ltBA","nohealthinsurance"].includes(t)?{note:true,superscript:true}:{note:true,superscript:false}}var setHeight=tdMap*.7;var width=tdMap,height=IS_PHONE?width-margin.top-margin.bottom:setHeight,centered,selectedState,selectedStatePh,selectedCounty,selectedCountyPh;d3.queue().defer(d3.json,"data/us-5m-2020-shapes.json").defer(d3.csv,pathFiles+"county_medical.csv").defer(d3.csv,pathFiles+"state_national_medical.csv").defer(d3.csv,pathFiles+"county_student.csv").defer(d3.csv,pathFiles+"state_national_student.csv").defer(d3.csv,pathFiles+"county_auto.csv").defer(d3.csv,pathFiles+"state_national_auto.csv").defer(d3.csv,pathFiles+"county_overall.csv").defer(d3.csv,pathFiles+"state_national_overall.csv").defer(d3.csv,pathFiles+"state_national_youth.csv").await(ready);function transformData(t){var e=d3.nest().key(function(t){return t.id}).entries(t);return e}function OverallTransformData(t,e,a,r,s){var l={};var n=null;var i=null;var o=null;var c=null;var d=transformData(a);d.forEach(function(r,t){for(var e in r["values"][0]){r[e]=r.values[0][e]}s.forEach(function(t,e){if(+r.key==t.id){for(var a in r["values"][0]){t[a]=r.values[0][a]}}})});var u=d.filter(function(t){return isNaN(+t.key)});var p=topojson.feature(t,t.objects.states).features;for(var h=0;h<p.length;h++){var f=p[h]["id"];for(var y=0;y<s.length;y++){if(s[y]["id"]==f){for(var b in s[y]){var v=isNaN(s[y][b])==true?s[y][b]:+s[y][b];p[h]["properties"][b]=v}break}}}n=transformData(e);i=d3.map(r,function(t){return t.id});n.forEach(function(t,e){for(var a in t["values"][0]){t[a]=t.values[0][a];i.get(t.key)[a]=t.values[0][a]}});o=n.filter(function(t){return t.state=="USA"});c=topojson.feature(t,t.objects.counties).features;for(var h=0;h<c.length;h++){var m=c[h]["id"];for(var b in i.get(m)){var v=isNaN(i.get(m)[b])==true?i.get(m)[b]:+i.get(m)[b];c[h]["properties"][b]=v}}l.tmp_state=p;l.tmp_county=c;l.filteredCounties=o;l.us_data_ph=u;l.state_data=d;l.county_data=n;return l}function buildprint(e,t){var a="<p><b>Notes:</b></p> "+$("#notes").html();$("#print-chart-notes").html(a);$("#print-chart-notes").append(variableListMaster.meta.dataSets[type].specialNotes);var r;var s;var l=[];var n=t.state_data[0]["values"][0];for(var i in n){if(n.hasOwnProperty(i)){if(+n[i]==NaN||+n[i]==0){n[i=n[i]]}else{n[i]=+n[i]}}}l.push(n);if(e){if(e["state"]){r=t.state_data.filter(function(t){return t.key==(e["state"].length===1?"0"+e["state"]:e["state"])});l.push(r[0])}if(e["county"]){s=t.county_data.filter(function(t){return t.key==e["county"]});l.push(s[0])}}var o=variableListMaster[type];var c=d3.select("#print-chart-container");printNameFinal="National";var d;try{printNameFinal=l[1].state;d=true;try{printNameFinal=l[2].county+", "+l[2].state;d=false}catch(t){}}catch(t){}if(printNameFinal==="National"){d3.select("body").classed("national",true)}else if(d===true){d3.select("body").classed("state",true)}c.selectAll(".print-chart").remove();c.selectAll(".print-chart").data(o).enter().append("div").attr("class","print-chart").append("div").attr("class","inner").html(function(t,e){return t.desktopLabel});c.selectAll(".print-chart").append("svg").attr("class",function(t){return t.variable+" print-row"}).attr("width","100%").attr("height","100%").each(function(t,e){var a=findPrintY(t.variable,l);buildPrintBars(this,t.variable,t.desktopLabel,l,a)});var u='<div class="print-footer-icon icon1"><img src="img/print-footer.png"></div>';var p='<div class="print-footer-icon icon2"><img src="img/print-footer.png"></div>';var h='<div class="print-footer-icon icon3"><img src="img/print-footer.png"></div>';var f=$(".print-chart:eq(3)");var y=$("#print-chart-notes");var b=$("#print-chart-notes");f.after(u);y.after(p);b.after(h)}function findPrintY(t,e){var a=[];var r=t+isDelinquency(t)[0],s=t+isDelinquency(t)[1];for(var l=0;l<e.length;l++){var n=[+e[l][t],+e[l][r],+e[l][s]];for(var i=0;i<n.length;i++){a.push(n[i])}}var o=d3.max(a);var c=d3.scaleLinear().domain([0,o]);return c}function buildPrintBars(t,e,a,s,r){var l=110,n=60,i=821,o=n*3+40,c=(i-3*o)/2;if(s.length===3){var d=["National","State","County"]}else if(s.length===2){var d=["National","State"]}else{var d=["National"]}var u=e+isDelinquency(e)[0];var p=e+isDelinquency(e)[1];var h=[e,u,p];var f=variableListMaster[type].filter(function(t){return t.variable==e});var y=f[0].columns;var b=40;var v=30;r.rangeRound([0,b]);var m=d3.select(t).selectAll("g").data(d).enter().append("g").attr("transform",function(t,e){var a=e*o+e*c;return"translate("+a+","+v+")"}).attr("class",function(t){return e+t+" bar-group"});m.append("text").text(function(t){if(t=="National"){return t}else if(t=="State"){return s[1]["state"]}else{return s[2]["county"]}}).attr("class",function(t){return"group-label-2 "+t}).attr("dy","-1.5em");var g=m.selectAll("g").data(h).enter().append("g").attr("class",function(t){return"category "+t}).attr("transform",function(t,e){return"translate("+70*e+","+10+")"});var E=g.append("g").attr("class",function(t){return"rect-g2 "+t}).attr("transform",function(t,e){return"translate("+0+","+15+")"});E.append("g").attr("class","g-text2").append("text").attr("x",0).attr("y",b+10).attr("dy",".71em").attr("text-anchor","start").text(function(t,e){for(var a=0;a<limitedVars.length;a++){if(t===limitedVars[a]+"_white"||t===limitedVars[a]+"_com_col"){return""}}var r=y[e];return r.substr(0,r.indexOf(" "))});E.append("text").attr("x",0).attr("y",b+21).attr("dy",".71em").attr("text-anchor","start").attr("class","g-text2").text(function(t,e){for(var a=0;a<limitedVars.length;a++){if(t===limitedVars[a]+"_white"||t===limitedVars[a]+"_com_col"){return""}}var r=y[e];return r.substr(r.indexOf(" ")+1)});var N=0;var _=0;var A=0;var S=0;var L=0;E.append("rect").attr("class","bar").attr("width",n).attr("y",function(t,e){var a=isNaN(s[N][t])?0:r(s[N][t]);if(e%3===2){N+=1}return 0+(b-a)}).attr("height",function(t,e){var a=isNaN(s[_][t])?0:r(s[_][t]);if(e%3===2){_+=1}return a}).attr("fill",function(t,e){if(e%3===0){return"#fdbf11"}else if(e%3===1){return"#000000"}else{return"#696969"}});E.append("text").text(function(t,e){var a=s[S][t];var r;if(isNaN(a)){if(a===undefined){r=""}else{r="n/a"}}else{r=formatNumber(a)}if(e%3===2){S+=1}return r}).attr("class","print-bar-text").attr("dy","-0.5em").attr("transform",function(t,e){var a=isNaN(s[A][t])?0:r(s[A][t]);if(e%3===2){A+=1}return"translate("+0+","+(0+(b-a))+")"}).append("tspan").attr("font-style","italic").attr("baseline-shift","super").text(function(t,e){var a=s[L][t];var r;if(isNaN(a)){r="b"}if(e%3===2){L+=1}return r})}function ready(error,us,county1,state1,county2,state2,county3,state3,county4,state4,state5){if(error)throw error;var countyData=us.objects.counties.geometries;var stateData=us.objects.states.geometries;if(Object.keys(Startquery).length>0){type=Startquery["type"]}else{type=variableListMaster.meta.default;Startquery["type"]=type}d3.selectAll("[data-cat]").classed("selected-nav",false);if(["youth","elderly"].includes(type)){d3.select(".filter-box-young-old-population").classed("hidden",false);d3.select(".filter-box-young-old-population>[data-cat='"+type+"']").classed("selected-filter",true);d3.select('#cat-nav>[data-cat="overall"]').classed("selected-nav",true);d3.select('#cat-nav-mobile>[data-cat="overall"]').classed("selected-nav",false);d3.select('#cat-nav-mobile>[data-cat="'+type+'"]').classed("selected-nav",true);d3.select("."+type+"-checkbox").property("checked",true);d3.select(".filter-box-clear-filter").classed("hidden",false)}else if(type=="overall"){d3.select(".filter-box-young-old-population").classed("hidden",false);d3.selectAll('[data-cat="overall"]').classed("selected-nav",true);d3.select(".filter-box-clear-filter").classed("hidden",true)}else{d3.select(".filter-box-young-old-population").classed("hidden",true);d3.selectAll('[data-cat="'+type+'"]').classed("selected-nav",true)}var defaultFirst;var sentCountyData=type!="youth"?eval(variableListMaster.meta.dataSets[type].county):eval(variableListMaster.meta.dataSets["overall"].county);var BigData=OverallTransformData(us,sentCountyData,eval(variableListMaster.meta.dataSets[type].state),countyData,stateData);defaultFirst=variableListMaster[type][0].variable;if(!Startquery["variable"]){typeVar=defaultFirst;Startquery["variable"]=typeVar;updateQueryString(type,typeVar)}else{typeVar=Startquery["variable"]}if(Startquery["print"]==="true"){buildprint(Startquery,BigData)}else{}setVariable(typeVar);setVariable(typeVar,true);var tmp_state=BigData.tmp_state,tmp_county=BigData.tmp_county,filteredCounties=BigData.filteredCounties,us_data_ph=BigData.us_data_ph,state_data=BigData.state_data,county_data=BigData.county_data;setZoom(true,false,false);d3.select("#debt-type").html(function(){return variableListMaster[type].filter(function(t){return t.variable===SELECTED_VARIABLE})[0].desktopLabel});d3.select("#measure").style("visibility","visible");d3.selectAll("#debt-caption, #print-debt-caption").text(function(t){return variableListMaster.meta.dataSets[type].caption});$("#searchBox").autocomplete({appendTo:".search-div"});$('input[name="tags"]').tagit({availableTags:dropdown,allowSpaces:true,autocomplete:{itemName:"item",fieldName:"tags",onlyAvailableTags:true,tagLimit:2,appendTo:".search-div",open:function(t,e){$("#ui-id-2").width($(".search-div").width());$("#ui-id-2").css("left","0px");$("#ui-id-2").css("top","87px")}},beforeTagAdded:function(t,e){if(dropdown.indexOf(e.tagLabel)==-1){return false}if(e.tagLabel=="not found"){return false}},afterTagAdded:function(t,e){$(".search-div > .ui-widget").css("height",60);var a=e.tag[0]["textContent"];var r=a.search(",")>0?a.split(",")[0]:"";var s=a.search(",")>0?a.split(", ")[1].slice(0,-1):a.slice(0,-1);var l=BigData.tmp_county;var n=a.search(",")>0?"county":"state";var i=n=="county"?r:s;selectedLocation();var o=l.filter(function(t){if(n=="county"){return t.properties["county"]==r&&t.properties["abbr"]==s}else{return t.properties["state"]==s}});var c=o[0];updateBars(SELECTED_VARIABLE,c);zoomMap(width,c,n);if(n=="county"){addTag(c["properties"]["state"],r,s)}else{var d=c["properties"]["abbr"];createSearchArray(d)}var u=o["0"].properties.state_id;var p=n=="county"?o["0"].properties.id:null;updateQueryString(type,SELECTED_VARIABLE,u,p)},afterTagRemoved:function(t,e){var a=e.tag[0]["textContent"];if(a.search(",")>0){d3.selectAll(".counties > path.selected").classed("selected",false);setZoom(false,true,false)}else{d3.selectAll(".state-borders > path.selected").classed("selected",false);setZoom(true,false,false);if(d3.select("li#state").size()==0){zoomMap(width,null,"national")}}updateBars(SELECTED_VARIABLE);createSearchArray("");$(".ui-widget-content.ui-autocomplete-input").attr("placeholder","Search for a state or county")}});$(".search-div > .ui-widget").css("height",60);$(".ui-widget-content.ui-autocomplete-input").css({"font-style":"italic"});$(".ui-widget-content.ui-autocomplete-input").css({"font-weight":"400"});$(".ui-widget-content.ui-autocomplete-input").attr("placeholder","Search for a state or county");$(".ui-widget-content.ui-autocomplete-input").focusin(function(){$(this).attr("placeholder","")});$(".ui-widget-content.ui-autocomplete-input").focusout(function(){$(this).attr("placeholder","Search for a state or county")});createSearchArray("");var zoom=d3.zoom().scaleExtent([0,8]);var min=d3.min(BigData.tmp_county,function(t){return t.properties[SELECTED_VARIABLE]});var max=d3.max(BigData.tmp_county,function(t){return t.properties[SELECTED_VARIABLE]});var quantize=d3.scaleThreshold().domain(variableListMaster[type].filter(function(t){return t.variable==SELECTED_VARIABLE})[0].breaks).range(["#cfe8f3","#73bfe2","#1696d2","#0a4c6a","#000000"]);var table=d3.select("#table-div");var stateMenu=d3.select(".state-menu").on("click",function(){if(d3.select(".state-menu.dropdown").classed("open")==true){$("#state-select").selectmenu("close");d3.select(".state-menu.dropdown").classed("open",false)}else{d3.select(".state-menu.dropdown").classed("open",true);$("#state-select").selectmenu("open")}}).append("select").attr("id","state-select");var optionsState=stateMenu.selectAll("option").data(state_data);optionsState.enter().append("option").text(function(t){return t.state}).attr("value",function(t){return t.state}).attr("value2",function(t){return t.key});var countyMenu=d3.select(".county-menu").on("click",function(){if(d3.select(".county-menu.dropdown").classed("open")==true){$("#county-select").selectmenu("close");d3.select(".county-menu.dropdown").classed("open",false)}else{d3.select(".county-menu.dropdown").classed("open",true);$("#county-select").selectmenu("open")}}).append("select").attr("id","county-select");var optionsCounty=countyMenu.selectAll("option").data(filteredCounties);optionsCounty.enter().append("option").text(function(t){return t.county});var categoryMenu=d3.select(".category-menu").on("click",function(){if(d3.select(".category-menu.dropdown").classed("open")==true){$("#category-select").selectmenu("close");d3.select(".category-menu.dropdown").classed("open",false)}else{d3.select(".category-menu.dropdown").classed("open",true);$("#category-select").selectmenu("open")}}).append("select").attr("id","category-select");var optionsCategory=categoryMenu.selectAll("option").data(variableListMaster[type]);optionsCategory.enter().append("option").html(function(t){return t.mobileLabel}).attr("value",function(t){return t.variable});d3.selectAll(".print-button").on("click",function(){if(!Startquery&&window.location.search===""){updateQueryString(type,SELECTED_VARIABLE)}window.open(window.location.search+"&print=true")});$(".categories").on("click",function(t){changeCategoryDataSet(t)});$("#filter-young-adult-population").on("click",function(t){changeCategoryDataSet(t)});$("#cat-pop-filter-checkbox").on("click",function(t){changeCategoryDataSet(t)});$("#clear-text").on("click",function(t){changeCategoryDataSet({currentTarget:d3.select('[data-cat="overall"]')._groups[0][0]})});function changeCategoryDataSet(t){var e=t.currentTarget.getAttribute("data-cat");if(d3.select(".selected-filter")._groups[0][0]?.getAttribute("data-cat")==e){e="overall"}if(e=="overall"||t.currentTarget.classList.contains("cat-pop-filter")||t.currentTarget.classList.contains("cat-pop-filter-checkbox")){d3.select(".filter-box-young-old-population").classed("hidden",false)}else{d3.select(".filter-box-young-old-population").classed("hidden",true)}d3.selectAll("[data-cat]").classed("selected-nav",false);d3.selectAll(".cat-pop-filter").classed("selected-filter",false);d3.selectAll(".cat-pop-filter-checkbox").property("checked",false);d3.selectAll(".filter-remove-button").classed("hidden",true);d3.select(".filter-box-clear-filter").classed("hidden",true);if(t.currentTarget.classList.contains("cat-pop-filter")&&["youth","elderly"].includes(e)){d3.select('#cat-nav>[data-cat="overall"]').classed("selected-nav",true);d3.select('#cat-nav-mobile>[data-cat="overall"]').classed("selected-nav",false);d3.select('#cat-nav-mobile>[data-cat="'+e+'"]').classed("selected-nav",true);t.currentTarget.classList.add("selected-filter");d3.select("."+e+"-checkbox").property("checked",true);d3.select(".filter-box-clear-filter").classed("hidden",false)}else{d3.selectAll('[data-cat="'+e+'"]').classed("selected-nav",true)}table.selectAll("tbody").classed("selected",false);table.select("tbody").classed("selected",true);BigData=changeData(e);type=e;var a=variableListMaster[type];var r=d3.select("#ftitle");r.text("All");var s=d3.select("#category-select").selectAll("option").data(a);s.enter().append("option").merge(s).html(function(t){return t.mobileLabel}).attr("value",function(t){return t.variable});s.exit().remove();$("#category-select").val(a[0].variable);$("#category-select").selectmenu("refresh");var l=variableListMaster[type][0].variable;setVariable(l);setVariable(l,true);updateMap(l);d3.select("#debt-caption").text(function(t){return variableListMaster.meta.dataSets[type].caption});d3.select("#debt-type").html(function(){return variableListMaster[type].filter(function(t){return t.variable===SELECTED_VARIABLE})[0].desktopLabel});$(".temp").remove();$("#notes").append(variableListMaster.meta.dataSets[type].specialNotes);$("#notes-section-inner").append(variableListMaster.meta.dataSets[type].specialNotes);var n;var i;if(zoomNational==true){var o=BigData.state_data[0]["values"][0];for(var c in o){if(o.hasOwnProperty(c)){if(+o[c]==NaN||+o[c]==0){o[c=o[c]]}else{o[c]=+o[c]}}}updateTable(o,type)}else if(zoomCounty==true&&type!="youth"){i=d3.select("g.counties").selectAll("path.selected").datum().id;n=d3.select("path#"+selectedState.properties.abbr).datum().id;updateTable(d3.select("g.counties").selectAll("path.selected").datum(),type)}else if(zoomState==true||type=="youth"){n=d3.select("path#"+selectedState.properties.abbr).datum().id;updateTable(d3.select("path#"+selectedState.properties.abbr).datum(),type)}else if(zoomNational_St==true){updateTable(d3.select("path#"+selectedState.properties.abbr).datum(),type)}if(zoomCounty&&type=="youth"){setZoom(false,true,false);updateBars(l,d3.select(".state-borders > path.selected").datum())}if(!zoomNational&&type=="youth"){d3.selectAll(".state-borders > path").style("opacity",.5).classed("hide",false);d3.select(".state-borders > path.selected").style("opacity",1)}else if(!zoomNational){d3.selectAll(".state-borders > path").classed("hide",true);d3.selectAll(".state-borders > path.selected").classed("hide",false)}if(zoomNational||zoomNational_St){d3.selectAll(".state-borders > path").style("opacity",1).classed("hide",false)}if(IS_PHONE===true){n=$("#state-select")[0].selectedOptions[0].__data__.key;if(n!="USA"){if($("#county-select")[0].length>0&&$("#county-select")[0].selectedOptions[0].value!=""){i=$("#county-select")[0].selectedOptions[0].__data__.key}else{i=""}}else{i="";n=""}if(type=="youth"){d3.select(".county-menu").style("display","none");i=""}else{d3.select(".county-menu").style("display","block")}}updateQueryString(type,l,n,i)}function changeData(CATEGORY){var fixedStateData=us.objects.states.geometries;var sentCountyData=CATEGORY!="youth"?eval(variableListMaster.meta.dataSets[CATEGORY].county):eval(variableListMaster.meta.dataSets["overall"].county);BigData=OverallTransformData(us,sentCountyData,eval(variableListMaster.meta.dataSets[CATEGORY].state),countyData,fixedStateData);var tmp_state=BigData.tmp_state,tmp_county=BigData.tmp_county,filteredCounties=BigData.filteredCounties,us_data_ph=BigData.us_data_ph,state_data=BigData.state_data,county_data=BigData.county_data;var countiesD3=d3.selectAll(".counties").selectAll("path").each(function(e){d3.select(this).datum(tmp_county.filter(function(t){return t.id==e.id})[0])});var statesD3=d3.select(".state-borders").selectAll("path").each(function(e){d3.select(this).datum(tmp_state.filter(function(t){return t.properties.abbr==e.properties.abbr})[0])});return BigData}function createSearchArray(t){var e=[];if(zoomNational==true){for(var a=0;a<tmp_state.length;a++){e.push(tmp_state[a]["properties"]["state"])}for(var a=0;a<tmp_county.length;a++){e.push(tmp_county[a]["properties"]["county"]+", "+tmp_county[a]["properties"]["abbr"])}}else if(zoomState==true){for(var a=0;a<tmp_county.length;a++){if(tmp_county[a]["properties"]["abbr"]==t){e.push(tmp_county[a]["properties"]["county"]+", "+tmp_county[a]["properties"]["abbr"])}}}dropdown=e;$('input[name="tags"]').tagit("option",{availableTags:dropdown})}function reset(){active.classed("active",false);active=d3.select(null);g.transition().duration(750).style("stroke-width","1.5px").attr("transform","")}function filterCountyMenu(e){var t=county_data.filter(function(t){return t.state==e});var a=countyMenu.selectAll("option").data(t);a.exit().remove();var r=a.enter().append("option").text(function(t){return t.county}).attr("value",function(t){return t.county});a.merge(r).text(function(t){return t.county}).attr("value",function(t){return t.county});if(e!="USA"){d3.selectAll(".dropdown-label").classed("disabled",false);d3.select("#county-select").append("option").text("Select a county").attr("value","").attr("selected","selected").attr("disabled","disabled").attr("hidden","hidden")}else{d3.select(".county-menu").select(".dropdown-label").classed("disabled",true)}$("#county-select").selectmenu("refresh")}var selectedLocation=function(){selectedCountyPh=d3.select("#county-select-button").select(".ui-selectmenu-text").text();selectedStatePh=d3.select("#state-select-button").select(".ui-selectmenu-text").text();$(".ui-widget-content.ui-autocomplete-input").blur()};$("#state-select").selectmenu({open:function(t,e){var a=$("#dropdown-div").width();var r=$(".banner").height()+$(".state-menu").outerHeight(true);$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("top",r+"px");$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("left","0px");$("ul#state-select-menu").css("width",a+"px");d3.select(".state-menu").select(".ui-icon").classed("arrow-up",true)},close:function(t,e){d3.select(".state-menu").select(".ui-icon").classed("arrow-up",false)},focus:function(t,e){},change:function(t,e){if(t.handleObj.type==="keydown"&&t.key==="r"){return}selectedLocation();var a=e.item.value;if(a!="USA"){$(".bar-State").css("display","block");$(".label-State").css("display","block");$(".bar-County").css("display","none");$(".label-County").css("display","none");d3.select(".county-menu").select(".ui-icon").classed("greyed",false);var r=e.item.value;var s=$("#category-select").val();updateBars(s,r);var l=e.item.element.context.attributes[1].value;updateQueryString(type,s,l);d3.select(".group-label-ph2.State").text(r);d3.select(".group-label-ph.State").text(r)}else{$(".bar-County").css("display","none");$(".bar-State").css("display","none");$(".label-County").css("display","none");$(".label-State").css("display","none");d3.select(".county-menu").select(".ui-icon").classed("greyed",true);var s=$("#category-select").val();updateQueryString(type,s,l)}filterCountyMenu(a)}}).selectmenu("menuWidget").addClass("ui-menu-icons customicons");$("#county-select").selectmenu({open:function(t,e){var a=$("#dropdown-div").width();var r=$(".banner").height()+$(".county-menu").outerHeight(true)+$(".state-menu").outerHeight(true);$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("top",r+"px");$("ul#county-select-menu").css("width",a+"px");$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("left","0px");d3.select(".county-menu").select(".ui-icon").classed("arrow-up",true)},close:function(t,e){d3.select(".county-menu").select(".ui-icon").classed("arrow-up",false)},change:function(t,e){if(t.handleObj.type==="keydown"&&t.key==="r"){return}selectedLocation();$(".bar-County").css("display","block");$(".label-County").css("display","block");var a=e.item.value;var r=$("#category-select").val();updateBars(r,a);d3.select(".group-label-ph2.County").text(a);d3.select(".group-label-ph.County").text(a);var s=e.item.element.context.__data__.key;var l=parseInt(s.substring(0,2));updateQueryString(type,r,l,s)}}).selectmenu("menuWidget").addClass("ui-menu-icons customicons");$("#category-select").selectmenu({open:function(t,e){var a=$("#dropdown-div").width();var r=$(".banner").height()+$(".category-menu").outerHeight(true)+$(".county-menu").outerHeight(true)+$(".state-menu").outerHeight(true);$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("width","100%");$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("top",r+"px");$("ul#category-select-menu").css("width",a);$(".ui-selectmenu-menu.ui-front.ui-selectmenu-open").css("left","0px");d3.select(".category-menu").select(".ui-icon").classed("arrow-up",true)},close:function(t,e){d3.select(".category-menu").select(".ui-icon").classed("arrow-up",false)},change:function(t,e){if(t.handleObj.type==="keydown"&&t.key==="r"){return}var a=e.item.value;selectedLocation();updateBars(a,selectedStatePh);setVariable(a,true);var r=$("#state-select")[0].selectedOptions[0].__data__.key;if(r!="USA"){if($("#county-select")[0].length>0&&$("#county-select")[0].selectedOptions[0].value!=""){countyQuery=$("#county-select")[0].selectedOptions[0].__data__.key}else{countyQuery=""}}else{countyQuery="";r=""}updateQueryString(type,a,r,countyQuery);hideBars(a)}}).selectmenu("menuWidget").addClass("ui-menu-icons customicons");d3.select(".county-menu").select(".ui-icon").classed("greyed",true);var svg=d3.select("#map").append("svg").attr("width",width+10).attr("height",height).attr("overflow","hidden");svg.append("rect").attr("width",width).attr("height",height).attr("class","background");var projection=d3.geoAlbersUsa();var path=d3.geoPath().projection(projection);var states=topojson.feature(us,us.objects.states);projection.fitSize([width,height],states);var translateWidth=IS_MOBILE?0:-20;var widthOnLoad=width;var g=svg.append("g").attr("class","map-g").attr("transform","translate("+translateWidth+",0) scale(.90)");g.append("g").attr("class","counties").selectAll("path").data(tmp_county).enter().append("path").attr("d",path).attr("id",function(t){return t.properties.abbr+t.id}).style("opacity",type=="youth"?0:1).style("fill",function(t){return isNaN(t.properties[SELECTED_VARIABLE])==true?"#adabac":quantize(t.properties[SELECTED_VARIABLE])}).on("click",function(t){var e=t.properties.state;var a=BigData.tmp_state.filter(function(t){return t.properties.state==e});var r=a[0];var s=d3.select(".state-borders > path.selected").node()!=null?d3.select(".state-borders > path.selected").attr("id"):"";var l=t["properties"];var n=zoomState==true&&s==t["properties"]["abbr"]&&type!="youth"?"county":"state";var i=t.properties["county"];var o=t.properties["abbr"];var c;var d=r.id;if(d3.select(this).classed("selected")==true){$(".tagit-new").css("display","block");d3.select(this).classed("selected",false);if(n=="county"){$("ul.tagit > li:nth-child(2)").remove();setZoom(false,true,false);updateTable(r,type);updateBars(SELECTED_VARIABLE,t)}}else{reset();var i=n=="state"?null:i;c=n=="state"?null:t.properties.id;addTag(e,i,o);zoomMap(width,t,n);updateBars(SELECTED_VARIABLE,t)}updateQueryString(type,SELECTED_VARIABLE,d,c)}).on("mouseover",function(t){var e=d3.select(".state-borders > path.selected").node()!=null?d3.select(".state-borders > path.selected").attr("id"):"";var a=t.properties.abbr;var r=zoomState==true&&e==a&&type!="youth"?"county":"state";var s=r=="county"?t.properties.county:"";var l=t.properties.abbr;if(zoomNational==true){$(".state-borders").css("pointer-events","all");$(".counties").css("pointer-events","none");hoverLocation("",t.properties.abbr,"state");updateBars(SELECTED_VARIABLE,t)}else{if(r=="state"){hoverLocation(s,l,r);updateBars(SELECTED_VARIABLE,d3.select("path#"+a).datum());d3.select("#National").attr("transform",function(){return"translate("+(width/3.1+5)*1+", 20)"});d3.select("#State").attr("transform",function(){return"translate(0, 20)"})}else{hoverLocation(s,l,r);updateBars(SELECTED_VARIABLE,t)}}}).on("mouseout",function(t){if(d3.select(".counties > path.selected").node()!=undefined&&type!="youth"){var e=d3.select(".counties > path.selected").datum().properties.county;var a=d3.select(".counties > path.selected").datum().properties.abbr;if(type!="youth"){d3.selectAll(".state-borders > path").classed("hide",true);d3.select(".state-borders > path#"+a).classed("hide",false)}else{d3.selectAll(".state-borders > path").style("opacity",.5).classed("hide",false);d3.select(".state-borders > path#"+a).style("opacity",1)}d3.selectAll("path.selected").moveToFront();d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);setZoom(false,true,true);updateBars(SELECTED_VARIABLE,d3.select(".counties > path.selected").datum());d3.select("#State").attr("transform",function(t,e){return"translate("+(width/3.1+5)*1+", 20)"})}else if(zoomNational&&d3.select(".counties > path.selected").node()!=undefined){d3.select("#County").attr("transform","translate(0, 20)");d3.select("#State").attr("transform",function(t,e){return"translate("+(width/3.1+5)*1+", 20)"});d3.select("#Nation").attr("transform",function(t,e){return"translate("+(width/3.1+5)*2+", 20)"})}else if(d3.select(".state-borders > path.selected").node()!=undefined){var r=d3.select(".state-borders > path.selected").datum().properties.state;var a=d3.select(".state-borders > path.selected").datum().properties.abbr;if(type!="youth"){d3.selectAll(".state-borders > path").classed("hide",true);d3.select(".state-borders > path#"+a).classed("hide",false)}else{d3.selectAll(".state-borders > path").style("opacity",.5).classed("hide",false);d3.select(".state-borders > path#"+a).style("opacity",1)}d3.selectAll("path.selected").moveToFront();d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);setZoom(false,true,false);updateBars(SELECTED_VARIABLE,d3.select(".state-borders > path.selected").datum());d3.select("#State").attr("transform","translate(0, 20)")}else if(zoomNational&&d3.select(".state-borders > path.selected").node()!=undefined){d3.select("#State").attr("transform","translate(0, 20)");d3.select("#Nation").attr("transform",function(t,e){return"translate("+(width/3.1+5)*1+", 20)"})}});g.append("g").attr("class","state-borders").selectAll("path").data(tmp_state).enter().append("path").attr("d",path).attr("id",function(t){return t.properties.abbr}).style("fill",function(t){if(type=="youth"){if(isNaN(t.properties[SELECTED_VARIABLE])){return"#adabac"}else{return quantize(t.properties[SELECTED_VARIABLE])}}else return"rgba(0,0,0,0)"}).on("click",function(t){d3.selectAll(".selectedNational").classed("selectedNational",false);var e=t.properties.state;var a=t.properties.abbr;var r="state";setZoom(false,true,false);zoomMap(width,t,r);addTag(e,null,a);updateBars(SELECTED_VARIABLE,t);var s=t.properties.id;var l;updateQueryString(type,SELECTED_VARIABLE,s,l)}).on("mouseover",function(t){if(zoomNational==true||zoomNational_St==true){hoverLocation("",t.properties.abbr,"state");updateBars(SELECTED_VARIABLE,t);if(d3.select(".state-borders > path.selected").datum().id===t.id){if(zoomNational==true||zoomNational_St==true){if(d3.select(".state-borders > path.selected").node()!=undefined&&zoomNational_St!=true){var e=d3.select(".state-borders > path.selected").datum().properties.state;d3.select("#National").attr("transform","translate(0, 20)");d3.selectAll("path.selected").moveToFront()}else if(zoomNational_St==true){d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);d3.selectAll("path.selected").moveToFront();var a=d3.select(".counties > path.selected").size()>0?d3.select(".counties > path.selected").datum():d3.select(".state-borders > path.selected").datum();var r=d3.select(".counties > path.selected").size()>0?a.properties["county"]+", "+a.properties["abbr"]:a.properties["state"];updateBars(SELECTED_VARIABLE,a)}else{d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);updateBars(SELECTED_VARIABLE,undefined)}}}}else{d3.select("#National").attr("transform",function(t,e){return"translate("+(width/3.1+5)*1+", 20)"})}}).on("mouseleave",function(t){if(d3.select(".state-borders > path.selected").node()==undefined){d3.select("#National").attr("transform","translate(0, 20)")}if(zoomNational==true||zoomNational_St==true){if(d3.select(".state-borders > path.selected").node()!=undefined&&zoomNational_St!=true){var e=d3.select(".state-borders > path.selected").datum().properties.state;d3.select("#National").attr("transform","translate(0, 20)");d3.selectAll("path.selected").moveToFront()}else if(zoomNational_St==true){d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);d3.selectAll("path.selected").moveToFront();d3.select("#National").attr("transform","translate(0, 20)");var a=d3.select(".counties > path.selected").size()>0?d3.select(".counties > path.selected").datum():d3.select(".state-borders > path.selected").datum();var r=d3.select(".counties > path.selected").size()>0?a.properties["county"]+", "+a.properties["abbr"]:a.properties["state"];updateBars(SELECTED_VARIABLE,a)}else{d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);updateBars(SELECTED_VARIABLE,undefined)}}}).on("mouseout",function(t){if(zoomNational==true||zoomNational_St==true){if(d3.select(".state-borders > path.selected").node()!=undefined&&zoomNational_St!=true){var e=d3.select(".state-borders > path.selected").datum().properties.state;d3.selectAll("path.selected").moveToFront()}else if(zoomNational_St==true){d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);d3.selectAll("path.selected").moveToFront();var a=d3.select(".counties > path.selected").size()>0?d3.select(".counties > path.selected").datum():d3.select(".state-borders > path.selected").datum();var r=d3.select(".counties > path.selected").size()>0?a.properties["county"]+", "+a.properties["abbr"]:a.properties["state"];updateBars(SELECTED_VARIABLE,a)}else{d3.selectAll(".hover").classed("hover",false).classed("hoverNational",false);updateBars(SELECTED_VARIABLE,undefined)}}});var data=[{x:width-35,y:height/1.5,id:"zoom_out"}];var button=svg.selectAll(".zoomBtn").data(data).enter().append("g").attr("class","zoomBtn").attr("id",function(t){return t.id}).attr("transform",function(t){return"translate("+t.x+","+(height-80)+")"});button.append("image").attr("xlink:href","img/reload.png").attr("x",-15).attr("y",10).attr("width",50).attr("height",50).on("click",function(){setZoom(false,false,false,true);zoomMap(width,null,"national");if(d3.select(".state-borders > path.selected").node()!=null&&d3.select(".counties > path.selected").node()===null){d3.select("#State").attr("transform","translate(0, 20)")}if(d3.select(".counties > path.selected").node()!=undefined){d3.select("#National").attr("transform",function(){return"translate("+(width/3.1+5)*2+", 20)"});d3.select("#State").attr("transform",function(){return"translate("+(width/3.1+5)*1+", 20)"});d3.select("#County").attr("transform","translate(0, 20)")}});var keyWidthPhMaster=width*.8;var svgPh=d3.select("#legend-div").append("svg").attr("width",keyWidthPhMaster).attr("height",60);var legendPh=svgPh.append("g").attr("class","g-legend-ph");legendPh.append("text").text(function(){if(SELECTED_VARIABLE==="delinquency_by_credit"){return"Subprime:"}else{return"All:"}}).attr("id","legend-title").attr("x",12).attr("y",17);var selectedMeasureExtent=d3.extent(BigData.tmp_county,function(t){if(!isNaN(t.properties[SELECTED_VARIABLE])){return t.properties[SELECTED_VARIABLE]}});var keyWidthPh=keyWidthPhMaster/9;var keyHeightPh=15;for(i=0;i<=6;i++){if(i<5){legendPh.append("rect").attr("width",keyWidthPh).attr("height",keyHeightPh).attr("class","rect"+i).attr("x",keyWidthPh*i+90).attr("y",5).style("fill",COLORRANGE[i]);legendPh.append("text").attr("y",34).attr("class","legend-labels-ph legend-labels-ph"+i).attr("x",keyWidthPh*i+92).attr("text-anchor","middle").text(function(){var t=selectedMeasureExtent[0];var e=variableListMaster[type].filter(function(t){return t.variable==SELECTED_VARIABLE})[0].breaks;return i==0?formatNumber(t,"min"):formatNumber(e[i-1])})}if(i==6){legendPh.append("rect").attr("width",keyWidthPh).attr("height",keyHeightPh).attr("class","rect"+i).attr("x",keyWidthPh*i+65).attr("y",5).style("fill","#ADABAC");legendPh.append("text").attr("y",34).attr("class","legend-labels-ph legend-labels-ph"+i).attr("x",keyWidthPh*i+85).attr("text-anchor","middle").text("n/a")}if(i==5){legendPh.append("text").attr("y",34).attr("class","legend-labels-ph legend-labels-ph"+i).attr("text-anchor","end").attr("x",keyWidthPh*i+90).attr("text-anchor","middle").text(function(){var t=selectedMeasureExtent[1];return formatNumber(t,"max")})}}legwidth=variableListMaster[type].filter(function(t){return t.variable==SELECTED_VARIABLE})[0].legendWidth;svg.append("rect").attr("width",function(){return IS_MOBILE?73:legwidth}).attr("class","rect-div").attr("height",215).style("fill","#f5f5f5").style("opacity",.8).attr("transform","translate("+(width-legwidth)+","+-1+")");var legend=svg.append("g").attr("class","g-legend").attr("transform","translate("+(width-55)+","+20+")");legend.append("text").text(function(){if(SELECTED_VARIABLE==="delinquency_by_credit"){return"Subprime"}else{return"All"}}).attr("id","ftitle").attr("x",33).attr("text-anchor","end");legend.append("text");var keyWidth=10;var keyHeight=25;var selectedMeasureExtent=d3.extent(BigData.tmp_county,function(t){if(!isNaN(t.properties[SELECTED_VARIABLE])){return t.properties[SELECTED_VARIABLE]}});for(i=0;i<=6;i++){if(i<5){legend.append("rect").attr("width",keyWidth).attr("height",keyHeight).attr("class","rect"+i).attr("y",keyHeight*i+23).attr("x",38).style("fill",COLORRANGE[i]);legend.append("text").attr("x",33).attr("class","legend-labels "+i).attr("y",keyHeight*i+23).attr("text-anchor","end").text(function(){var t=selectedMeasureExtent[0];var e=variableListMaster[type].filter(function(t){return t.variable==SELECTED_VARIABLE})[0].breaks;return i==0?formatNumber(t,"min"):formatNumber(e[i-1])})}if(i==6){legend.append("rect").attr("width",keyWidth).attr("height",keyHeight).attr("class","rect"+i).attr("y",keyHeight*i+10).attr("x",38).style("fill","#ADABAC");legend.append("text").attr("x",33).attr("class","legend-labels "+i).attr("y",keyHeight*i+28).attr("text-anchor","end").text("n/a")}if(i==5){legend.append("text").attr("x",33).attr("class","legend-labels "+i).attr("text-anchor","end").attr("y",keyHeight*i+23).text(function(){var t=d3.max(BigData.tmp_county,function(t){if(isNaN(t.properties[SELECTED_VARIABLE])){return-100}else{return t.properties[SELECTED_VARIABLE]}});return formatNumber(t,"max")})}}d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;if(t){this.parentNode.insertBefore(this,t)}})};function hoverLocation(e,a,r){var t=tmp_county;var s=t.filter(function(t){if(r=="county"){return t.properties.county==e&&t.properties.abbr==a}else{return t.properties.abbr==a}});var l=r=="county"?s[0]["id"]:"";if(d3.select("path#"+s[0]["properties"]["abbr"]+l).classed("hover")==true){}else{d3.select("path#"+s[0]["properties"]["abbr"]+l).classed("hover",true).classed("hide",false).classed("hoverNational",function(){return zoomNational==true||zoomNational_St?true:false}).moveToFront();if(type=="youth"&&!zoomNational){d3.select("path#"+s[0]["properties"]["abbr"]+l).style("opacity",1)}}}$("#notes.temp").remove();$("#notes-section-inner.temp").remove();$("#notes").append(variableListMaster.meta.dataSets[type].specialNotes);$("#notes-section-inner").append(variableListMaster.meta.dataSets[type].specialNotes);var us_data=state_data[0]["values"][0];for(var key in us_data){if(us_data.hasOwnProperty(key)){if(+us_data[key]==NaN||+us_data[key]==0){us_data[key=us_data[key]]}else{us_data[key]=+us_data[key]}}}$("#table-div").empty();var table=d3.select("#table-div").append("table");updateTable(us_data,type);table.selectAll("tbody").filter(function(t){return t.variable===typeVar}).classed("selected",true);var groups=["County","State","National"];var grabVar=variableListMaster[type].filter(function(t){return t.variable==SELECTED_VARIABLE_ph});var barData=[{data:us_data_ph[0]},{data:us_data_ph[0]},{data:us_data_ph[0]}];var barSvgHeight_ph=IS_PHONESM?200:173;var barWidth_ph=IS_PHONESM?width:width*.85;var x_ph=d3.scaleLinear().range([0,barWidth_ph]);var y_ph=d3.scaleBand().range([30,0]);x_ph.domain([0,d3.max(BigData.county_data,function(t){if(isNaN(t[NONWHITE_ph])==true&&isNaN(t[WHITE_ph])==true){return+t[SELECTED_VARIABLE_ph]}else if(isNaN(t[NONWHITE_ph])==true&&isNaN(t[WHITE_ph])==false){return Math.max(+t[WHITE_ph],+t[SELECTED_VARIABLE_ph])}else if(isNaN(t[WHITE_ph])==true&&isNaN(t[NONWHITE_ph])==false){return Math.max(+t[NONWHITE_ph],+t[SELECTED_VARIABLE_ph])}else{return Math.max(+t[WHITE_ph],+t[NONWHITE_ph],+t[SELECTED_VARIABLE_ph])}})]);y_ph.domain(us_data_ph.map(function(t){return t[SELECTED_VARIABLE_ph]}));var xAxis_ph=d3.axisBottom().scale(x_ph).ticks(0);var yAxis_ph=d3.axisLeft().scale(y_ph).ticks(0);for(var i=0;i<groups.length;i++){var group=groups[i];d3.select(".label-"+group).append("svg").attr("width",400).attr("height",20).append("text").text(group).attr("class",function(){return"group-label-ph "+group}).attr("transform","translate("+15+","+15+")").attr("text-anchor","start");var barLabel=d3.select(".label-"+group).append("svg").attr("width",182).attr("height",130).attr("class","svg2");barLabel.selectAll("g").data(grabVar[0].columns).enter().append("g").append("text").text(function(t,e){return t}).attr("class","category-labels-ph").attr("transform",function(t,e){return IS_PHONESM?"translate("+0+","+(52*e+57)+")":"translate("+174+","+(40*e+25)+")"}).attr("text-anchor","end");d3.select(".bar-"+group).append("svg").attr("width",barWidth_ph).attr("height",barSvgHeight_ph);var barG_ph=d3.select(".bar-"+group).select("svg").append("g").attr("class",function(t,e){return"bar-group-ph "+group}).attr("transform",function(t,e){return IS_PHONESM?"translate("+0+","+20+")":"translate("+100+","+0+")"});barG_ph.append("text").text(function(t,e){return group}).attr("class",function(t,e){return"group-label-ph2 "+group});barG_ph.append("text").attr("class","group-label-2").attr("transform",function(t,e){var a=d3.select(".group-label-ph2."+group).node().getBoundingClientRect().width+5;return"translate("+a+","+0+")"});var subBarPh=barG_ph.selectAll("g").data(grabVar[0].columns).enter().append("g").attr("class",function(t,e){return"category-ph c"+e}).attr("transform",function(t,e){return IS_PHONESM?"translate("+0+","+52*e+")":"translate("+0+","+40*e+")"});d3.selectAll(".bar-County, .bar-State, .label-County, .label-State").style("display","none");var rectG_ph=subBarPh.append("g").attr("class",function(t,e){return"rect-g c"+e}).attr("transform",function(t,e){return"translate("+0+","+28+")"});rectG_ph.append("g").data(barData).append("text").attr("class","data-label-ph").attr("y",12).attr("dy",".71em");rectG_ph.selectAll(".data-label-ph").data([us_data]).attr("x",function(t){return barX(t,this,SELECTED_VARIABLE_ph,NONWHITE_ph,WHITE_ph,x_ph)}).text(function(t){var e=$(this).closest(".rect-g").attr("class");if(limitedVars.filter(function(t){return t==SELECTED_VARIABLE_ph})===[]){if(e.search("c0")>-1){return formatNumber(t[SELECTED_VARIABLE_ph])}else if(e.search("c2")>-1){return formatNumber(t[NONWHITE_ph])}else{return formatNumber(t[WHITE_ph])}}else{if(e.search("c0")>-1){return formatNumber(t[SELECTED_VARIABLE_ph])}}});rectG_ph.append("g").attr("class","g-text-ph").append("text").attr("x",0).attr("y",-13).attr("dy",".71em").attr("text-anchor","start").text(function(t,e){return t});rectG_ph.append("g").attr("class","x axis").attr("transform",function(t,e){return"translate("+0+","+30+")"}).call(xAxis_ph);rectG_ph.append("g").attr("class","y axis").call(yAxis_ph);rectG_ph.selectAll("rect").data(us_data_ph).enter().append("rect").attr("x",0).attr("y",0).attr("class","bar-ph").attr("height",y_ph.bandwidth()).attr("width",function(t){var e=d3.select(this.parentNode).attr("class");if(limitedVars.filter(function(t){return t==SELECTED_VARIABLE_ph})===[]){if(e.search("c0")>-1){return x_ph(+t[SELECTED_VARIABLE_ph])}else if(e.search("c2")>-1){return x_ph(+t[NONWHITE_ph])}else{return x_ph(+t[WHITE_ph])}}else{if(e.search("c0")>-1){return x_ph(+t[SELECTED_VARIABLE_ph])}else{return 0}}}).attr("fill",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return"#fdbf11"}else if(e.search("c2")>-1){return"#696969"}else{return"#000000"}})}hideBars(SELECTED_VARIABLE_ph);var barSvgHeight=IS_MOBILE?185:130;var barHeight=IS_MOBILE?90:65;var barWidth=IS_MOBILE?42:50;var x=d3.scaleBand().rangeRound([0,barWidth]);var y=d3.scaleLinear().rangeRound([barHeight,0]);county_data.forEach(function(t){t.national=+t.values[0][SELECTED_VARIABLE];t.white=+t.values[0][WHITE];t.nonwhite=+t.values[0][NONWHITE]});x.domain([[us_data].map(function(t){return t.abbr})]);y.domain([0,d3.max(BigData.county_data,function(t){if(isNaN(t.nonwhite)==true&&isNaN(t.white)==true){return t.national}else if(isNaN(t.nonwhite)==true&&isNaN(t.white)==false){return Math.max(t.white,t.national)}else if(isNaN(t.white)==true&&isNaN(t.nonwhite)==false){return Math.max(t.nonwhite,t.national)}else{return Math.max(t.white,t.nonwhite,t.national)}})]);var formatPercent=d3.format(".0%");var xAxis=d3.axisBottom().scale(x);var yAxis=d3.axisLeft().scale(y).tickFormat(formatPercent);var chartPadding=IS_MOBILE?15:0;var barSvg=d3.select("#bar-chart").append("svg").attr("width",width-chartPadding).attr("height",barSvgHeight);var barG=barSvg.selectAll("g").data(groups).enter().append("g").attr("transform",function(t,e){var a=[zoomNational,zoomState,zoomCounty].indexOf(true);return"translate("+(width/3.1+5)*a+", 20)"}).attr("id",function(t){return t}).attr("class","bar-group");barG.append("text").text(function(t){return t=="National"?t:""}).attr("class",function(t,e){return"group-label-2 c"+e});barG.append("text").attr("class","group-label-2");var subBarG=barG.selectAll("g").data(grabVar[0].columns).enter().append("g").attr("class",function(t,e){return"category c"+e}).attr("transform",function(t,e){return IS_MOBILE?"translate("+(barWidth+2)*e+","+10+")":"translate("+60*e+","+10+")"});var rectG=subBarG.append("g").attr("class",function(t,e){return"rect-g c"+e}).attr("transform",function(t,e){return"translate("+0+","+15+")"});rectG.selectAll("rect").data([us_data]).enter().append("rect").attr("x",function(t){return x(t.abbr)}).attr("class","bar").attr("fill",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return"#fdbf11"}else if(e.search("c2")>-1){return"#696969"}else{return"#000000"}}).attr("width",x.bandwidth()).attr("y",function(t){return barY(t,this,SELECTED_VARIABLE,NONWHITE,WHITE,y,barHeight)}).attr("height",function(t){return barH(t,this,SELECTED_VARIABLE,NONWHITE,WHITE,y,barHeight)});d3.selectAll(".rect-g").each(function(t,e){d3.select(this).data([us_data]).append("text").attr("class","bar-text").attr("x",0).attr("y",function(t){return labelY(t,this,SELECTED_VARIABLE,NONWHITE,WHITE,y,barHeight)}).attr("dy",".71em").attr("text-anchor","start").attr("class","data-label").text(function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return formatNumber(t[SELECTED_VARIABLE])}else if(e.search("c2")>-1){return formatNumber(t[NONWHITE])}else{return formatNumber(t[WHITE])}})});if(limitedVars.filter(function(t){return t==SELECTED_VARIABLE}).length!=0){$(".category.c1").css("display","none");$(".category.c2").css("display","none")}else{$(".category.c1").css("display","block");$(".category.c2").css("display","block")}d3.selectAll("#State, #County").style("opacity",0);d3.select("#Nation").attr("transform","translate(0, 20)");function updateMap(s){var t=BigData.tmp_county;if(type=="youth"){t=BigData.tmp_state}var l=d3.extent(t,function(t){if(!isNaN(t.properties[SELECTED_VARIABLE])){return t.properties[SELECTED_VARIABLE]}});var e=d3.scaleThreshold().domain(variableListMaster[type].filter(function(t){return t.variable==s})[0].breaks).range(["#cfe8f3","#73bfe2","#1696d2","#0a4c6a","#000000"]);d3.selectAll(".legend-labels").each(function(t,r){if(r!=6){d3.select(this).text(function(){var t=l[0];var e=l[1];var a=variableListMaster[type].filter(function(t){return t.variable==s})[0].breaks;if(r==0){if(s=="med_mon_pmt"){return"$95"}else{return formatNumber(t,"min")}}else if(r==5){if(s=="perc_stud_debt"){return"32%"}else if(s=="perc_stud_debt_collect"){return"12%"}else if(s=="perc_stud_debt_collect_STUD"){return"67%"}else if(s=="med_mon_pmt"){return"$275"}else if(s=="perc_no_bach"){return"98%"}else{return formatNumber(e,"max")}}else{return formatNumber(a[r-1])}})}});d3.selectAll(".legend-labels-ph").each(function(t,r){if(r!=6){d3.select(this).text(function(){var t=l[0];var e=l[1];var a=variableListMaster[type].filter(function(t){return t.variable==s})[0].breaks;if(r==0){return formatNumber(t,"min")}else if(r==5){return formatNumber(e,"max")}else{return formatNumber(a[r-1])}})}});var a=d3.select("#legend-title").text(function(){if(SELECTED_VARIABLE==="delinquency_by_credit"){return"Subprime:"}else{return"All:"}});if(type!="youth"){d3.select(".state-borders").selectAll("path").transition().duration(800).style("fill","rgba(0,0,0,0)");d3.select(".counties").selectAll("path").transition().duration(800).style("opacity",1).style("fill",function(t){return t==undefined||isNaN(t.properties[s])==true?"#adabac":e(t.properties[s])})}else{d3.select(".counties").selectAll("path").transition().duration(800).style("opacity",0);d3.select(".state-borders").selectAll("path").classed("states-showing",true).transition().duration(800).style("fill",function(t){return isNaN(t.properties[SELECTED_VARIABLE])?"#adabac":e(t.properties[SELECTED_VARIABLE])})}var r=d3.select("path.selected").node()!=null?d3.select("path.selected").datum():undefined;updateBars(s,r)}function updateBarLegend(t){d3.selectAll("li.key").remove();d3.selectAll("#bar-chart-legend > li").style("opacity",1);var a=["#fdbf11","#000000","#696969"];d3.select("#bar-chart-legend").selectAll("li").data(t).enter().append("li").text(function(t){return t}).attr("class",function(t,e){return"key desktop-bar-legend-"+e}).style("border-right",function(t,e){return"15px solid"+a[e]});if(limitedVars.indexOf(SELECTED_VARIABLE)>-1){d3.selectAll("#bar-chart-legend > li").style("opacity",0)}}var barDataLabels=variableListMaster[type].filter(function(t){return t.variable===SELECTED_VARIABLE})[0].columns;updateBarLegend(barDataLabels);function updateBars(a,t){var e=variableListMaster[type].filter(function(t){return t.variable===SELECTED_VARIABLE})[0].columns;updateBarLegend(e);var r=BigData.state_data[0]["values"][0];for(var s in r){if(r.hasOwnProperty(s)){if(+r[s]==NaN||+r[s]==0){r[s=r[s]]}else{r[s]=+r[s]}}}d3.select("#notes-section").selectAll("p.note2, p.note1").style("opacity",1);let l=needsConnecticutACSnote(a);d3.select("#notes-section > p.note4").style("display",l.note?"block":"none");d3.select("#notes > p.note4").style("display",l.note?"block":"none");var n=a+isDelinquency(a)[0];var i=a+isDelinquency(a)[1];var o=BigData.county_data;grabVar=variableListMaster[type].filter(function(t){return t.variable==a});if(IS_PHONE){var c=BigData.state_data.filter(function(t){return t.state==selectedStatePh});var d=BigData.county_data.filter(function(t){return t.county==selectedCountyPh&&t.state==selectedStatePh});x_ph.domain([0,d3.max(o,function(t){var e;if(isNaN(+t[i])==true&&isNaN(+t[n])==true){e=+t[a]}else if(isNaN(+t[i])==true&&isNaN(+t[n])==false){e=Math.max(+t[n],+t[a])}else if(isNaN(+t[n]==true&&isNaN(+t[i]))==false){e=Math.max(+t[i],+t[a])}else{e=Math.max(+t[n],+t[i],+t[a])}if(isNaN(e)==true){e=0}return e})]);var u=d3.select(".bar-group-ph.National").selectAll(".category-ph");var p=-1;u.each(function(){d3.select(this).select(".bar-ph").data(BigData.us_data_ph).transition().duration(300).attr("width",function(t){return barW(t,this,a,i,n,x_ph)});d3.select(this).select(".data-label-ph").data(BigData.us_data_ph).attr("x",function(t){return barX(t,this,a,i,n,x_ph)}).attr("y",12).html(function(t){return labelHTML_ph(t,this,a,i,n)});d3.select(this).select(".g-text-ph > text").text(function(){var t=["Subprime","Near prime","Prime"];var e=["All","White communities","Communities of color"];p+=1;if(a==="delinquency_by_credit"){return t[p]}else{return e[p]}})});var h=d3.select(".bar-group-ph.State").selectAll(".category-ph");var f=-1;h.each(function(){d3.select(this).select(".bar-ph").data(c).transition().duration(300).attr("width",function(t){return barW(t,this,a,i,n,x_ph)});d3.select(this).select(".data-label-ph").data(c).attr("x",function(t){return barX(t,this,a,i,n,x_ph)}).html(function(t){return labelHTML_ph(t,this,a,i,n)});d3.select(this).select(".g-text-ph > text").text(function(){var t=["Subprime","Near prime","Prime"];var e=["All","White communities","Communities of color"];f+=1;if(a==="delinquency_by_credit"){return t[f]}else{return e[f]}})});if(selectedCountyPh!=""&&type!="youth"){var b=d3.select(".bar-group-ph.County").selectAll(".category-ph");var v=-1;b.each(function(){d3.select(this).select(".bar-ph").data(d).transition().duration(300).attr("width",function(t){return barW(t,this,a,i,n,x_ph)});d3.select(this).select(".data-label-ph").data(d).attr("x",function(t){return barX(t,this,a,i,n,x_ph)}).html(function(t){return labelHTML_ph(t,this,a,i,n,"yes")});d3.select(this).select(".g-text-ph > text").text(function(){var t=["Subprime","Near prime","Prime"];var e=["All","White communities","Communities of color"];v+=1;if(a==="delinquency_by_credit"){return t[v]}else{return e[v]}})})}else if(type=="youth"){d3.select(".bar-County").style("display","none");d3.select(".label-County").style("display","none")}d3.selectAll(".category-labels-ph").text(function(t,e){return grabVar[0].columns[e%3]});hideBars(a)}else{var o=type=="youth"?BigData.state_data:BigData.county_data;var m=d3.scaleBand().rangeRound([0,barWidth]);o.forEach(function(t){t.national=+t.values[0][a];t.white=+t.values[0][WHITE];t.nonwhite=+t.values[0][NONWHITE]});m.domain([[r].map(function(t){return t.abbr})]);y.domain([0,d3.max(o,function(t){if(isNaN(t.nonwhite)==true&&isNaN(t.white)==true){return t.national}else if(isNaN(t.nonwhite)==true&&isNaN(t.white)==false){return Math.max(t.white,t.national)}else if(isNaN(t.white)==true&&isNaN(t.nonwhite)==false){return Math.max(t.nonwhite,t.national)}else{return Math.max(t.white,t.nonwhite,t.national)}})]);var u=d3.select("#National").selectAll(".category");u.each(function(){d3.select(this).select(".bar").data([r]).transition().duration(300).attr("y",function(t){return barY(t,this,a,NONWHITE,WHITE,y,barHeight)}).attr("height",function(t){return barH(t,this,a,NONWHITE,WHITE,y,barHeight)});d3.select(this).select(".data-label").data([r]).attr("y",function(t){return labelY(t,this,a,NONWHITE,WHITE,y,barHeight)}).text(function(t){return labelHTML(t,this,a,NONWHITE,WHITE)}).append("tspan").attr("font-style","italic").attr("baseline-shift","super").text(function(t){return labelsuperscript(t,this,a,NONWHITE,WHITE)})});if(zoomNational==true&&t==null){d3.selectAll("#State, #County").style("opacity",0);d3.select("#Nation").attr("transform","translate(0, 20)")}else if(zoomNational_St&&t==null){}else if(zoomNational==false||t!=null){var g=d3.select(".counties > path.selected").node()==null?"":d3.select(".counties > path.selected").attr("id");var E=d3.select(".counties > path.hover").node()==null?"":d3.select(".counties > path.hover").attr("id");var N=g==""?"":g.slice(2);var _=t["properties"]["abbr"];var o=BigData.tmp_county;var h=d3.select("#State").selectAll(".category");var A=d3.select("path#"+t["properties"]["abbr"]).datum();var S=A["properties"];d3.select("#State").select(".group-label-2").text(S["state"]);d3.select("#National").attr("transform",function(){return"translate("+(width/3.1+5)*2+", 20)"});h.each(function(){d3.select(this).select(".bar").data([S]).transition().duration(300).attr("y",function(t){return barY(t,this,a,NONWHITE,WHITE,y,barHeight)}).attr("height",function(t){return barH(t,this,a,NONWHITE,WHITE,y,barHeight)});d3.select(this).select(".data-label").data([S]).attr("y",function(t){return labelY(t,this,a,NONWHITE,WHITE,y,barHeight)}).text(function(t){return labelHTML(t,this,a,NONWHITE,WHITE)}).append("tspan").attr("font-style","italic").attr("baseline-shift","super").text(function(t){return labelsuperscript(t,this,a,NONWHITE,WHITE)})});if((g.slice(0,2)==_||E.slice(0,2)==_)&&type!="youth"){d3.selectAll("#National, #State, #County").style("opacity",1);d3.select("#National").attr("transform",function(){return"translate("+(width/3.1+5)*2+", 20)"});d3.select("#State").attr("transform",function(){return"translate("+(width/3.1+5)*1+", 20)"});d3.select("#County").attr("transform","translate(0, 20)");var b=d3.select("#County").selectAll(".category");var L=t["properties"];d3.select("#County").select(".group-label-2").text(L["county"]);b.each(function(){d3.select(this).select(".bar").data([L]).transition().duration(300).attr("y",function(t){return barY(t,this,a,NONWHITE,WHITE,y,barHeight)}).attr("height",function(t){return barH(t,this,a,NONWHITE,WHITE,y,barHeight)});d3.select(this).select(".data-label").data([L]).attr("y",function(t){return labelY(t,this,a,NONWHITE,WHITE,y,barHeight)}).text(function(t){return labelHTML(t,this,a,NONWHITE,WHITE)}).append("tspan").attr("font-style","italic").attr("baseline-shift","super").text(function(t){return labelsuperscript(t,this,a,NONWHITE,WHITE)})})}else{d3.selectAll("#County").style("opacity",0);d3.selectAll("#National, #State").style("opacity",1);d3.select("#National").attr("transform",function(){return"translate("+(width/3.1+5)*1+", 20)"});d3.select("#State").attr("transform","translate(0, 20)")}}}hidelimited(a)}function addTag(r,e,t){var a=IS_MOBILE?80:60;$(".search-div > .ui-widget").css("height",a);d3.selectAll("li.tagit-choice").remove();var s=$("ul.tagit").append('<li id="state" class="tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable"></li>');$("li#state").insertBefore(".tagit-new").append('<span class="tagit-label">'+r+"</span>");$("li#state").append('<a class="tagit-close"</a>');$("li#state > a.tagit-close").append('<span class="text-icon"</span>');$("li#state > a.tagit-close").append('<span class="ui-icon ui-icon-close"</span>');setZoom(false,true,false);createSearchArray(t);$("li#state").on("click",function(){d3.selectAll("path.selectedNational").classed("selectedNational",false);d3.selectAll("li.tagit-choice").remove();$(".tagit-new").css("display","block");$(".ui-widget-content.ui-autocomplete-input").focusout(function(){$(this).attr("placeholder","Search for a state or county")});d3.selectAll("path.selected").classed("selected",false);setZoom(true,false,false);zoomMap(width,null,"national");createSearchArray("");var t;var e;updateQueryString(type,SELECTED_VARIABLE,t,e);d3.select("#National").attr("transform","translate(0, 20)")});if(e!=undefined){var s=$("ul.tagit").append('<li id="county" class="tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable"></li>');$("li#county").insertBefore(".tagit-new").append('<span class="tagit-label">'+e+"</span>");$("li#county").append('<a class="tagit-close"</a>');$("li#county > a.tagit-close").append('<span class="text-icon"</span>');$("li#county > a.tagit-close").append('<span class="ui-icon ui-icon-close"</span>');setZoom(false,true,true);$(".tagit-new").css("display","none");var l=BigData.tmp_county.filter(function(t){return t.properties["county"]==e&&t.properties["state"]==r});$("li#county").on("click",function(){var t=BigData.tmp_state.filter(function(t){return t.properties["state"]==r});d3.selectAll(".counties").selectAll("path.selectedNational").classed("selectedNational",false);$(".tagit-new").css("display","block");$(".tagit-new").css("autocomplete","on");$(".ui-widget-content.ui-autocomplete-input").focusout(function(){$(this).attr("placeholder","")});setZoom(false,true,false);d3.select(this).remove();d3.selectAll(".counties > path.selected").classed("selected",false);updateBars(SELECTED_VARIABLE,l[0]);d3.select("#State").attr("transform","translate(0, 20)");d3.select("#Nation").attr("transform",function(t,e){return"translate("+(width/3.1+5)*1+", 20)"});updateTable(t[0],type);var e=t[0].id;var a;updateQueryString(type,SELECTED_VARIABLE,e,a)});updateBars(SELECTED_VARIABLE,l[0])}}function updateTable(s,l){var t=["All","White","NonWhite"];var e=[1,2,3];if(l){var n=variableListMaster[l];var a=table.selectAll("tbody").data(variableListMaster[l]);a.classed("medical",false);a.classed("student",false);a.classed("auto",false);a.classed("youth",false);a.classed(l,true);a.enter().append("tbody").merge(a).attr("class",function(t,e){return l+" "+t.nondebtfirst+" "+" new group group-"+e}).on("click",function(t){d3.selectAll("tbody").classed("selected",false);d3.select(this).classed("selected",true);d3.select(".rect-div").attr("width",function(){return IS_MOBILE?73:t.legendWidth}).attr("transform","translate("+(width-t.legendWidth)+","+-1+")");setVariable(t.variable);updateMap(t.variable);d3.select("#debt-type").html(function(){return variableListMaster[l].filter(function(t){return t.variable===SELECTED_VARIABLE})[0].desktopLabel});var e=d3.select("#ftitle");e.text(function(){if(SELECTED_VARIABLE==="delinquency_by_credit"){return"Subprime"}else{return"All"}});var a;var r;if(d3.select("g.counties").selectAll("path.selected")._groups[0].length!==0){r=d3.select("g.counties").selectAll("path.selected").datum().id}if(d3.select("g.state-borders").selectAll("path.selected")._groups[0].length!==0){a=d3.select("path#"+selectedState.properties.abbr).datum().id}updateQueryString(l,SELECTED_VARIABLE,a,r);if(limitedVars.filter(function(t){return t==SELECTED_VARIABLE}).length!=0){$(".category.c1").css("display","none");$(".category.c2").css("display","none")}else{$(".category.c1").css("display","block");$(".category.c2").css("display","block")}});a.exit().remove();var r=table.selectAll("tbody.new").selectAll("tr").data(e);r.enter().append("tr").attr("class",function(t,e){if(e%3==0){return"cell-header new"}else if(e%3==2){return"cell-column"}else{return"cell-data"}});d3.selectAll(".cell-header.new").selectAll("th").data([1]).enter().append("th").attr("colspan",3);d3.selectAll(".cell-header").select("th").each(function(t,e){d3.select(this).html(function(){return variableListMaster[l][e].desktopLabel})});d3.selectAll(".cell-column").each(function(t,e){var a=variableListMaster[l][e].columns;d3.select(this).selectAll("td").data(a).enter().append("td").merge(d3.select(this).selectAll("td")).text(function(t){return t})});d3.selectAll(".cell-data").each(function(t,e){var a=variableListMaster[l][e].variable,r=a+isDelinquency(a)[1];rowVariable_wh=a+isDelinquency(a)[0];var s=variableListMaster[l][e].columns;d3.select(this).selectAll("td").data(s).enter().append("td").text(function(t,e){if(e==0){return us_data[a]==undefined?"N/A":formatNumber(us_data[a])}else if(e==1){return us_data[rowVariable_wh]==undefined?"N/A":formatNumber(us_data[rowVariable_wh])}else if(e==2){return us_data[r]==undefined?"N/A":formatNumber(us_data[r])}})})}var s=zoomNational==true?s:s["properties"];d3.selectAll("p.note1, p.note2").style("opacity",1);d3.selectAll(".cell-data").each(function(t,e){var a=[n[e].variable];rowVariable_nw=a+isDelinquency(a[0])[1];rowVariable_wh=a+isDelinquency(a[0])[0];if(s[a]=="n<50"||s[rowVariable_nw]=="n<50"||s[rowVariable_wh]=="n<50"){d3.select("p.note1").style("opacity",1)}if(s[a]=="N/A"||s[rowVariable_nw]=="N/A"||s[rowVariable_wh]=="N/A"){d3.select("p.note2").style("opacity",1)}let r=needsConnecticutACSnote(a[0]);d3.select("#notes-section > p.note4").style("display",r.note?"block":"none");d3.select("#notes > p.note4").style("display",r.note?"block":"none");d3.select(this).selectAll("td").html(function(t,e){if(e==0){if(isNaN(s[a])==true){return r.superscript?"n/a<sup><i>d</i></sup>":"n/a<sup><i>b</i></sup>"}else{return formatNumber(s[a])}}else if(e==1){if(isNaN(s[rowVariable_wh])==true){return r.superscript?"n/a<sup><i>d</i></sup>":"n/a<sup><i>b</i></sup>"}else{return formatNumber(s[rowVariable_wh])}}else if(e==2){if(isNaN(s[rowVariable_nw])==true){return r.superscript?"n/a<sup><i>d</i></sup>":"n/a<sup><i>b</i></sup>"}else{return formatNumber(s[rowVariable_nw])}}})})}function zoomMap(t,e,a){var r,s,l;d3.select(".state-borders").selectAll("path").classed("hide",false).classed("selectedNational",false);if(a!="national"){$(".zoomBtn").css("display","block");$(".tagit-new > input").attr("placeholder","");d3.selectAll("path.hoverNational").classed("hoverNational",false);if(type!="youth"){d3.select(".state-borders").selectAll("path:not(#"+e.properties.abbr+")").classed("hide",true)}else{d3.selectAll(".counties > path").style("opacity",0);d3.selectAll(".state-borders > path").style("opacity",.5).classed("hide",false);d3.select(".state-borders > path#"+e.properties.abbr).style("opacity",1)}$(".state-borders").css("pointer-events","none");$(".counties").css("pointer-events","all");d3.selectAll("path").classed("selected",false);d3.select("path#"+e["properties"]["abbr"]).classed("selected",true).moveToFront();setZoom(false,true,false);for(var n=0;n<tmp_state.length;n++){if(tmp_state[n]["properties"]["state"]==e.properties.state){selectedState=tmp_state[n]}}var i=a=="state"?d3.select("path#"+selectedState.properties.abbr).datum():e;updateTable(i,type);if(active.node()===this)return reset();active.classed("active",false);active=d3.select("path#"+e.properties.abbr).classed("active",true);var o=path.bounds(selectedState),c=o[1][0]-o[0][0],d=o[1][1]-o[0][1],r=(o[0][0]+o[1][0])/2,s=(o[0][1]+o[1][1])/2,u=type=="youth"?.65/Math.max(c/t,d/height):.9/Math.max(c/t,d/height),p=[t/2-u*r,height/2-u*s];g.transition().duration(750).attr("transform","translate("+p+")scale("+u+")");if(a=="county"){setZoom(false,true,true);d3.selectAll("g.counties > path").classed("selected",false);d3.select("path#"+e["properties"]["abbr"]+e.id).classed("selected",true).moveToFront()}}else{if(IS_MOBILE==true){d3.selectAll(".hover").classed("hover",false)}if(zoomNational_St==true){updateBars(SELECTED_VARIABLE,null);if(d3.select(".state-borders > path.selected").node()!=null&&d3.select(".counties > path.selected").node()===null){d3.select("#State").attr("transform","translate(0, 20)")}}else{setZoom(true,false,false);var h=BigData.state_data[0]["values"][0];for(var f in h){if(h.hasOwnProperty(f)){if(+h[f]==NaN||+h[f]==0){h[f=h[f]]}else{h[f]=+h[f]}}}updateTable(h,type);updateBars(SELECTED_VARIABLE,e)}$(".zoomBtn").css("display","none");$(".tagit-new > input").attr("placeholder","");$(".state-borders").css("pointer-events","all");$(".counties").css("pointer-events","none");r=t/1.4;s=height/1.5;l=.7;centered=null;g.selectAll("path").style("opacity",1).classed("active",centered&&function(t){return t===centered});var y=IS_MOBILE?0:-50,b=IS_MOBILE?(t-50)/widthOnLoad:(t-50)/widthOnLoad;g.transition().duration(750).attr("transform","translate("+y+",0)scale("+b+")");d3.selectAll("path.selected").classed("selectedNational",true)}}$(window).resize(function(){if(!Startquery||Startquery["print"]!="true"){setScreenState(d3.select("#isMobile").style("display")==="block",d3.select("#isPhone").style("display")==="block",d3.select("#isPhoneSm").style("display")==="block");initialWidth=IS_PHONE?$("body").width():$("body").width()-$(".td-table").width();barSvgHeight=IS_MOBILE?185:130;r=IS_PHONESM?200:173;barHeight=IS_MOBILE?90:65;barWidth=IS_MOBILE?42:50;setHeight=tdMap*.7;var t=d3.scaleBand().rangeRound([0,barWidth]);var e=d3.axisBottom().scale(t).ticks(0);setWidth(initialWidth,IS_MOBILE,IS_PHONE);var a=IS_MOBILE?0:15;width=tdMap-a;height=IS_PHONE?width-margin.top-margin.bottom:setHeight;if(IS_PHONE){var r=IS_PHONESM?200:173;var s=IS_PHONESM?width:width*.85;var l=d3.scaleLinear().range([0,s]);l.domain([0,d3.max(BigData.county_data,function(t){var e;if(isNaN(t[NONWHITE_ph])==true&&isNaN(t[WHITE_ph])==true){e=t[SELECTED_VARIABLE_ph]}else if(isNaN(t[NONWHITE_ph])==true&&isNaN(t[WHITE_ph])==false){e=Math.max(t[WHITE_ph],t[SELECTED_VARIABLE_ph])}else if(isNaN(t[WHITE_ph]==true&&isNaN(t[NONWHITE_ph]))==false){e=Math.max(t[NONWHITE_ph],t[SELECTED_VARIABLE_ph])}else{e=Math.max(t[WHITE_ph],t[NONWHITE_ph],t[SELECTED_VARIABLE_ph])}if(isNaN(e)==true){e=0}return e})]);d3.selectAll(".bar-group-ph").selectAll(".category-ph").each(function(t,e){d3.select(this).attr("transform",function(){return IS_PHONESM?"translate("+0+","+52*e+")":"translate("+50+","+40*e+")"})});d3.selectAll("g.bar-group-ph").each(function(t,e){d3.select(this).attr("transform",function(){return IS_PHONESM?"translate("+0+","+20+")":"translate("+50+","+0+")"})});d3.selectAll(".label").selectAll(".category-labels-ph").each(function(t,e){d3.select(this).attr("transform",function(){return IS_PHONESM?"translate("+0+","+(52*e+57)+")":"translate("+174+","+(40*e+25)+")"})});d3.selectAll(".label").attr("width",width*.15).attr("height",163);d3.selectAll(".bar_ph").select("svg").attr("width",s).attr("height",r);d3.selectAll(".bar-ph").attr("width",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE_ph])!=true?l(t[SELECTED_VARIABLE_ph]):0}else if(e.search("c2")>-1){return isNaN(t[NONWHITE_ph])!=true?l(t[NONWHITE_ph]):0}else{return isNaN(t[WHITE_ph])!=true?l(t[WHITE_ph]):0}});d3.selectAll(".data-label-ph").attr("x",function(t){var e=$(this).closest(".rect-g").attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE_ph])!=true?l(t[SELECTED_VARIABLE_ph])+5:0}else if(e.search("c2")>-1){return isNaN(t[NONWHITE_ph])!=true?l(t[NONWHITE_ph])+5:0}else{return isNaN(t[WHITE_ph])!=true?l(t[WHITE_ph])+5:0}})}else{var n=IS_MOBILE?80:60;$(".search-div > .ui-widget").css("height",n);if(d3.selectAll("path.selected").size()>0){setZoom(false,false,false,true);zoomMap(width,null,"national")}else{setZoom(true,false,false)}d3.select(".state-borders").selectAll("path").classed("hide",false);d3.selectAll("path.selected").classed("selectedNational",true);var o=width*.8;var c=d3.select("#legend-div").select("svg").attr("width",o);var d=o/8;for(i=0;i<=6;i++){if(i<5){c.select(".rect"+i).attr("width",d).attr("x",d*i+50);d3.select(".legend-labels-ph"+i).attr("x",d*i+55)}if(i==6){c.select(".rect"+i).attr("width",d).attr("x",d*i+17);d3.select(".legend-labels-ph"+i).attr("x",d*i+45)}if(i==5){d3.select(".legend-labels-ph"+i).attr("x",d*i+55)}}var u=IS_MOBILE?15:0;d3.select("#bar-chart").select("svg").attr("width",width-u).attr("height",barSvgHeight);d3.selectAll(".bar-group").each(function(t,e){d3.select(this).attr("transform",function(t,e){return"translate("+(width/3.1+5)*e+","+20+")"})});d3.selectAll(".category").each(function(t,e){d3.select(this).attr("transform",function(t,e){return IS_MOBILE?"translate("+(barWidth+2)*e+","+10+")":"translate("+60*e+","+10+")"})});d3.selectAll(".x.axis").attr("transform",function(t,e){return"translate("+0+","+barHeight+")"}).call(e);rectG.selectAll(".bar").attr("width",t.bandwidth()).attr("y",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE])!=true?y(t[SELECTED_VARIABLE]):barHeight}else if(e.search("c2")>-1){return isNaN(t[NONWHITE])!=true?y(t[NONWHITE]):barHeight}else{return isNaN(t[WHITE])!=true?y(t[WHITE]):barHeight}}).attr("height",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE])!=true?barHeight-y(t[SELECTED_VARIABLE]):0}else if(e.search("c2")>-1){return isNaN(t[NONWHITE])!=true?barHeight-y(t[NONWHITE]):0}else{return isNaN(t[WHITE])!=true?barHeight-y(t[WHITE]):0}});d3.selectAll(".bar-text").attr("y",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE])!=true?y(t[SELECTED_VARIABLE])-16:barHeight-8}else if(e.search("c2")>-1){return isNaN(t[NONWHITE])!=true?y(t[NONWHITE])-16:barHeight-8}else{return isNaN(t[WHITE])!=true?y(t[WHITE])-16:barHeight-8}});d3.selectAll(".data-label").attr("y",function(t){var e=d3.select(this.parentNode).attr("class");if(e.search("c0")>-1){return isNaN(t[SELECTED_VARIABLE])!=true?y(t[SELECTED_VARIABLE])-16:barHeight-8}else if(e.search("c2")>-1){return isNaN(t[NONWHITE])!=true?y(t[NONWHITE])-16:barHeight-8}else{return isNaN(t[WHITE])!=true?y(t[WHITE])-16:barHeight-8}});$("table").height($("table").width()*.8);d3.select("#map").select("svg").attr("width",width).attr("height",height);svg.select("rect").attr("width",width).attr("height",height);var p=IS_MOBILE?0:-20,h=IS_MOBILE?(width-50)/widthOnLoad:(width-50)/widthOnLoad;svg.select(".map-g").transition().duration(750).attr("transform","translate("+p+",0) scale("+h+")");d3.selectAll(".bar-group").each(function(t,e){d3.select(this).attr("transform",function(){return"translate("+(width/3.1+5)*(e-1)+","+20+")"})});barG.selectAll(".category").each(function(t,e){d3.select(this).attr("transform",function(){return IS_MOBILE?"translate("+(barWidth+2)*e+","+10+")":"translate("+60*e+","+10+")"})});d3.selectAll(".zoomBtn").each(function(t,e){d3.select(this).attr("transform",function(){return"translate("+(width-35)+","+(height-80+e*40)+")"})});d3.select(".g-legend").attr("height",height/2).attr("width",function(){return IS_MOBILE?45:50}).attr("transform","translate("+(width-55)+","+20+")");d3.select(".rect-div").attr("width",function(){return IS_MOBILE?73:65}).attr("transform","translate("+(width-64)+","+-1+")")}}});if(Startquery&&Startquery["print"]!="true"){if(Startquery["county"]||Startquery["state"]){if(!Startquery["state"]){stateQuery=parseInt(Startquery["county"].substring(0,2));Startquery["state"]=stateQuery;updateQueryString(type,typeVar,stateQuery,Startquery["county"])}var geoData=BigData.tmp_county;var geoType=Startquery["county"]?"county":"state";var filteredData=geoData.filter(function(t){if(geoType=="county"){return t.id==Startquery["county"]}else{return t.properties["state_id"]==Startquery["state"]}});var data=filteredData[0];zoomMap(width,data,geoType);$("#state-select").val(filteredData[0].properties.state);$("#state-select").selectmenu("refresh");selectedLocation();$(".bar-State").css("display","block");$(".label-State").css("display","block");d3.select(".group-label-ph2.State").text(filteredData[0].properties.state);d3.select(".group-label-ph.State").text(filteredData[0].properties.state);filterCountyMenu(filteredData[0].properties.state);d3.select(".county-menu").select(".ui-icon").classed("greyed",false);$("#county-select").selectmenu("refresh");var county=null;if(geoType=="county"){addTag(data.properties.state,data.properties.county,data.properties.abbr);$(".bar-County").css("display","block");$(".label-County").css("display","block");$("#county-select").val(filteredData[0].properties.county);$("#county-select").selectmenu("refresh");selectedLocation();d3.select(".group-label-ph2.County").text(filteredData[0].properties.county);d3.select(".group-label-ph.County").text(filteredData[0].properties.county);if(IS_PHONE){county=filteredData[0].properties.county;updateBars(typeVar,county)}}else{addTag(data.properties.state,null,data.properties.abbr);$(".ui-widget-content.ui-autocomplete-input").attr("placeholder","");var filter=data["properties"]["abbr"];createSearchArray(filter);var stateData=BigData.tmp_state.filter(function(t){return t.properties.state==data.properties.state});updateBars(typeVar,stateData[0])}}else{updateBars(typeVar)}$("#category-select").val(Startquery["variable"]);$("#category-select").selectmenu("refresh")}else if(Startquery["print"]==="true"){d3.select("#debt-type").html(printNameFinal);d3.select(".youth-banner").classed("hidden",true);d3.select("#cat-nav").classed("hidden",true);d3.select("#cat-nav-mobile").classed("hidden",true);d3.select(".print-button").classed("hidden",true);d3.select(".debt-title-flex-filter-box").classed("hidden",true)}}